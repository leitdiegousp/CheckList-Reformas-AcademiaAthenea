<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check List Reformas</title>
    
    <!-- Bibliotecas para Export e Gr√°ficos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(30, 60, 114, 0.3);
        }
        
        .logo {
            max-width: 150px;
            height: auto;
            margin-bottom: 15px;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
        }
        
        h1 {
            text-align: center;
            margin: 0;
            color: white;
            font-size: 24px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            line-height: 1.4;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 30px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        th, td {
            border: 1px solid #e0e0e0;
            padding: 15px;
            text-align: left;
        }
        
        th {
            background: linear-gradient(135deg, #1565C0 0%, #1976D2 100%);
            color: white;
            font-weight: 600;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .section-header {
            background: linear-gradient(135deg, #2196F3 0%, #42A5F5 100%);
            color: white;
            font-weight: 700;
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 15px 20px;
        }
        
        .checkbox-cell {
            text-align: center;
            width: 10%;
            background-color: #f8f9fa;
        }
        
        .text-cell {
            width: 15%;
            background-color: #ffffff;
        }
        
        input[type="checkbox"] {
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: #2196F3;
            vertical-align: middle;
        }
        
        input[type="text"], textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 14px;
            resize: both;
            min-height: 40px;
            min-width: 100px;
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
            background-color: #e3f2fd;
        }
        
        input[type="text"]::placeholder, textarea::placeholder {
            color: #999;
            font-size: 13px;
            font-style: italic;
        }
        
        .action-cell {
            padding-left: 20px;
            font-size: 16px;
            line-height: 1.6;
            background-color: #ffffff;
        }
        
        .action-cell label {
            cursor: pointer;
            vertical-align: middle;
            margin-left: 10px;
            font-weight: 500;
            color: #1565C0;
        }
        
        .action-cell input[type="checkbox"] {
            vertical-align: middle;
        }
        
        .materials-section {
            background-color: #e3f2fd;
        }
        
        .materials-header {
            background: linear-gradient(135deg, #64B5F6 0%, #90CAF9 100%);
            color: #0d47a1;
            font-weight: 700;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding: 12px 20px;
            text-align: left;
        }
        
        .material-item {
            padding-left: 40px;
            font-size: 15px;
            line-height: 1.5;
            color: #1565C0;
        }
        
        .material-item label {
            cursor: pointer;
            vertical-align: middle;
            margin-left: 10px;
            font-weight: 500;
        }
        
        .material-item input[type="checkbox"] {
            vertical-align: middle;
        }
        
        /* Anima√ß√µes suaves */
        tr {
            transition: all 0.3s ease;
        }
        
        /* Hover para linhas de atividade (a√ß√µes) */
        tbody tr:not(.materials-section):hover {
            background-color: #e3f2fd;
            transform: translateX(3px);
            box-shadow: -3px 0 0 0 #2196F3;
        }
        
        /* Hover especial para cabe√ßalhos de se√ß√£o */
        tbody tr:has(.section-header):hover {
            background: linear-gradient(135deg, #1976D2 0%, #42A5F5 100%);
            transform: translateX(5px);
            box-shadow: -5px 0 0 0 #0d47a1;
        }
        
        /* Hover para linhas de materiais */
        .materials-section:hover {
            background-color: #bbdefb;
            transform: translateX(2px);
            box-shadow: -2px 0 0 0 #64B5F6;
        }
        
        /* Hover especial para header de materiais */
        tr:has(.materials-header):hover {
            background: linear-gradient(135deg, #42A5F5 0%, #64B5F6 100%);
            transform: translateX(3px);
        }
        
        /* Estilos para Mobile */
        @media screen and (max-width: 768px) {
            body {
                padding: 10px;
                background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            }
            
            .container {
                padding: 15px;
                overflow-x: auto;
            }
            
            .header {
                padding: 15px;
                margin-bottom: 20px;
            }
            
            .logo {
                max-width: 100px;
            }
            
            h1 {
                font-size: 18px;
                letter-spacing: 1px;
            }
            
            table {
                font-size: 14px;
                min-width: 800px;
            }
            
            th, td {
                padding: 12px 8px;
            }
            
            th {
                font-size: 14px;
            }
            
            .section-header {
                font-size: 16px;
            }
            
            .materials-header {
                font-size: 15px;
            }
            
            .checkbox-cell {
                width: 60px;
                min-width: 60px;
            }
            
            .text-cell {
                width: 150px;
                min-width: 150px;
            }
            
            input[type="text"], textarea {
                font-size: 16px; /* Evita zoom no iOS */
                padding: 12px;
                min-height: 60px;
                min-width: 140px;
                resize: both;
                overflow: auto;
            }
            
            /* Aumenta a √°rea de redimensionamento */
            textarea::-webkit-resizer {
                border: 3px solid #2196F3;
                background: #2196F3;
                width: 24px;
                height: 24px;
                border-radius: 4px;
            }
            
            .action-cell {
                padding-left: 15px;
                min-width: 250px;
                font-size: 15px;
            }
            
            input[type="checkbox"] {
                width: 24px;
                height: 24px;
            }
            
            .materials-header {
                padding-left: 15px;
            }
            
            .material-item {
                padding-left: 30px;
                font-size: 14px;
            }
        }
        
        /* Estilos espec√≠ficos para telas muito pequenas (< 480px) */
        @media screen and (max-width: 480px) {
            h1 {
                font-size: 18px;
            }
            
            table {
                min-width: 900px; /* For√ßa scroll horizontal */
            }
            
            .text-cell {
                width: 180px;
                min-width: 180px;
            }
            
            input[type="text"], textarea {
                min-height: 80px;
                font-size: 16px;
            }
            
            .action-cell {
                font-size: 14px;
            }
            
            .material-item {
                font-size: 13px;
            }
        }
        
        /* ============================================ */
        /* ANIMA√á√ïES PARA INDICADORES DE SINCRONIZA√á√ÉO */
        /* ============================================ */
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        @media print {
            body {
                background-color: white;
            }
            .container {
                box-shadow: none;
            }
        }
        
        /* Estilos para os √≠cones de prioridade */
        .priority-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, #FF9800 0%, #FF6F00 100%);
            border-radius: 50%;
            color: white;
            font-weight: bold;
            font-size: 14px;
            margin-right: 8px;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.4);
            border: 2px solid #FFB74D;
            vertical-align: middle;
        }
        
        /* Estilos para tarefas conclu√≠das */
        .task-completed {
            text-decoration: line-through;
            opacity: 0.6;
            color: #757575;
        }
        
        .task-completed::after {
            content: " ‚úÖ Conclu√≠da";
            text-decoration: none;
            color: #4CAF50;
            font-weight: bold;
            font-size: 14px;
            margin-left: 10px;
        }
        
        /* Estilo para dropdown de prioridade */
        .priority-dropdown {
            width: 100%;
            padding: 8px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            background-color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .priority-dropdown:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 5px rgba(33, 150, 243, 0.3);
        }
        
        .priority-dropdown option[value="urgente"] {
            background-color: #ffebee;
            color: #d32f2f;
            font-weight: bold;
        }
        
        .priority-dropdown option[value="nao-urgente"] {
            background-color: #e8f5e9;
            color: #388e3c;
            font-weight: bold;
        }
        
        /* Cores do dropdown baseado na sele√ß√£o */
        .priority-dropdown.urgente {
            background-color: #ffebee;
            color: #d32f2f;
            border-color: #ef5350;
        }
        
        .priority-dropdown.nao-urgente {
            background-color: #e8f5e9;
            color: #388e3c;
            border-color: #66bb6a;
        }
        
        /* Legenda */
        .legend {
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 5px solid #FF9800;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .legend-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, #FF9800 0%, #FF6F00 100%);
            border-radius: 50%;
            color: white;
            font-weight: bold;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.4);
            border: 2px solid #FFB74D;
            flex-shrink: 0;
        }
        
        .legend-text {
            color: #E65100;
            font-weight: 600;
            font-size: 15px;
            line-height: 1.4;
        }
        
        /* Estilo especial para a se√ß√£o Mutir√£o */
        .section-header-mutirao {
            background: linear-gradient(135deg, #D32F2F 0%, #F44336 100%) !important;
            color: white;
            font-weight: 700;
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 15px 20px;
            box-shadow: 0 4px 12px rgba(211, 47, 47, 0.4);
            border-left: 5px solid #B71C1C;
        }
        
        @media screen and (max-width: 768px) {
            .legend {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }
            
            .priority-badge {
                width: 26px;
                height: 26px;
                font-size: 13px;
            }
        }
        
        /* ============================================ */
        /* SISTEMA DE BUSCA E FILTROS */
        /* ============================================ */
        
        .search-filter-container {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 45px 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 15px;
            transition: all 0.3s ease;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #2196F3;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.2);
        }
        
        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #757575;
            font-size: 20px;
        }
        
        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        
        .filter-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .filter-btn.active {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        
        .filter-btn.urgente {
            border-color: #ef5350;
            color: #ef5350;
        }
        
        .filter-btn.urgente.active {
            background: #ef5350;
            color: white;
        }
        
        .filter-btn.concluidas {
            border-color: #4CAF50;
            color: #4CAF50;
        }
        
        .filter-btn.concluidas.active {
            background: #4CAF50;
            color: white;
        }
        
        .stats-bar {
            width: 100%;
            display: flex;
            justify-content: space-around;
            padding: 15px;
            background: linear-gradient(135deg, #f5f5f5 0%, #eeeeee 100%);
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #1976D2;
        }
        
        .stat-label {
            font-size: 12px;
            color: #757575;
            text-transform: uppercase;
            margin-top: 5px;
        }
        
        /* ============================================ */
        /* TEMA ESCURO */
        /* ============================================ */
        
        body.dark-theme {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        
        body.dark-theme .container {
            background-color: #0f3460;
            color: #e0e0e0;
        }
        
        body.dark-theme .header {
            background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
        }
        
        body.dark-theme table {
            background-color: #16213e;
        }
        
        body.dark-theme th {
            background: linear-gradient(135deg, #0f3460 0%, #16213e 100%);
        }
        
        body.dark-theme td {
            background-color: #1a1a2e;
            color: #e0e0e0;
            border-color: #2d3561;
        }
        
        body.dark-theme .section-header {
            background: linear-gradient(135deg, #16213e 0%, #1976D2 100%) !important;
        }
        
        body.dark-theme .search-filter-container {
            background-color: #16213e;
        }
        
        body.dark-theme .search-box input {
            background-color: #1a1a2e;
            color: #e0e0e0;
            border-color: #2d3561;
        }
        
        body.dark-theme .filter-btn {
            background-color: #1a1a2e;
            color: #e0e0e0;
            border-color: #2d3561;
        }
        
        body.dark-theme .stats-bar {
            background: linear-gradient(135deg, #16213e 0%, #1a1a2e 100%);
        }
        
        body.dark-theme .legend {
            background: linear-gradient(135deg, #2d3561 0%, #16213e 100%);
        }
        
        body.dark-theme .legend-text {
            color: #FFB74D;
        }
        
        /* Bot√£o de tema */
        .theme-toggle {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1002;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: 0 6px 16px rgba(0,0,0,0.4);
        }
        
        body.dark-theme .theme-toggle {
            background: linear-gradient(135deg, #FFA726 0%, #FF9800 100%);
        }
        
        /* Anima√ß√µes */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .search-filter-container {
            animation: slideIn 0.5s ease;
        }
        
        /* Linha oculta (para filtros) */
        tr.hidden {
            display: none;
        }
        
        /* === Estilos para Export e Gr√°ficos === */
        .export-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px auto;
            max-width: 1400px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .export-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .export-btn.pdf {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .export-btn.pdf:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }
        
        .export-btn.excel {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
        }
        
        .export-btn.excel:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        .charts-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin: 20px auto;
            max-width: 1400px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 20px;
        }
        
        .chart-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        /* Limitar altura do gr√°fico de pizza */
        .chart-box canvas {
            max-height: 300px;
            margin: 0 auto;
            display: block;
        }
        
        /* Mobile - mostrar apenas progresso geral */
        @media (max-width: 768px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-box:nth-child(2) {
                display: none;
            }
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .progress-bar-container {
            width: 100%;
            height: 30px;
            background-color: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .progress-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c 0%, #f39c12 50%, #27ae60 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        /* Dark theme para export e gr√°ficos */
        body.dark-theme .export-container,
        body.dark-theme .charts-container {
            background-color: #16213e;
        }
        
        body.dark-theme .charts-container h2 {
            color: #e0e0e0;
        }
        
        body.dark-theme .chart-box {
            background-color: #1a1a2e;
        }
        
        body.dark-theme .chart-title {
            color: #e0e0e0;
        }
        
        body.dark-theme .progress-bar-container {
            background-color: #1a1a2e;
        }
        
        /* === SISTEMA DE NOTIFICA√á√ïES === */
        .notification-badge {
            position: fixed;
            top: 70px;
            right: 10px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
            transition: all 0.3s ease;
            z-index: 1001;
            animation: pulse 2s infinite;
        }
        
        .notification-badge:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.6);
        }
        
        .notification-badge.hidden {
            display: none;
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        .notification-panel {
            position: fixed;
            top: 130px;
            right: 10px;
            width: 350px;
            max-height: 500px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            overflow: hidden;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        
        .notification-panel.open {
            transform: translateX(0);
        }
        
        .notification-header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 15px 20px;
            font-weight: bold;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .notification-close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.3s;
        }
        
        .notification-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .notification-list {
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }
        
        .notification-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
            animation: slideIn 0.3s ease;
        }
        
        .notification-item.success {
            border-left-color: #27ae60;
        }
        
        .notification-item.info {
            border-left-color: #3498db;
        }
        
        .notification-item.warning {
            border-left-color: #f39c12;
        }
        
        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        
        .notification-message {
            font-size: 14px;
            color: #555;
            margin-bottom: 5px;
        }
        
        .notification-time {
            font-size: 12px;
            color: #999;
        }
        
        .notification-empty {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }
        
        /* Dark theme para notifica√ß√µes */
        body.dark-theme .notification-panel {
            background: #16213e;
        }
        
        body.dark-theme .notification-item {
            background: #1a1a2e;
        }
        
        body.dark-theme .notification-title {
            color: #e0e0e0;
        }
        
        body.dark-theme .notification-message {
            color: #b0b0b0;
        }
        
        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 130px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            display: none;
            animation: slideDown 0.3s ease;
        }
        
        .offline-indicator.show {
            display: block;
        }
        
        @keyframes slideDown {
            from {
                transform: translateX(-50%) translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateX(-50%) translateY(0);
                opacity: 1;
            }
        }
        
        /* === SISTEMA DE FOTOS === */
        .photo-container {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #ddd;
        }
        
        .photo-upload-area {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .photo-upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .photo-upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .photo-input {
            display: none;
        }
        
        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .photo-item {
            position: relative;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .photo-item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
        
        .photo-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
            display: block;
        }
        
        .photo-delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231, 76, 60, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .photo-item:hover .photo-delete-btn {
            opacity: 1;
        }
        
        .photo-delete-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }
        
        /* Modal de visualiza√ß√£o de foto */
        .photo-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .photo-modal.active {
            display: flex;
        }
        
        .photo-modal-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
        }
        
        .photo-modal-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 8px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
        }
        
        .photo-modal-close {
            position: absolute;
            top: -40px;
            right: 0;
            background: white;
            color: #333;
            border: none;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .photo-modal-close:hover {
            background: #e74c3c;
            color: white;
            transform: rotate(90deg);
        }
        
        body.dark-theme .photo-container {
            background-color: #1a1a2e;
            border-color: #333;
        }
        
        body.dark-theme .photo-item {
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1);
        }
        
        body.dark-theme .photo-item:hover {
            box-shadow: 0 4px 16px rgba(255, 255, 255, 0.2);
        }
        
    </style>
</head>
<body>
    <button class="theme-toggle" id="themeToggle" title="Alternar tema">üåô</button>
    
    <!-- Badge de Notifica√ß√µes -->
    <div class="notification-badge hidden" id="notificationBadge" title="Ver notifica√ß√µes">
        <span id="notificationCount">0</span>
    </div>
    
    <!-- Painel de Notifica√ß√µes -->
    <div class="notification-panel" id="notificationPanel">
        <div class="notification-header">
            <span>üîî Notifica√ß√µes</span>
            <button class="notification-close" id="closeNotifications">√ó</button>
        </div>
        <div class="notification-list" id="notificationList">
            <div class="notification-empty">Nenhuma notifica√ß√£o</div>
        </div>
    </div>
    
    <!-- Indicador Offline -->
    <div class="offline-indicator" id="offlineIndicator">
        üì° Modo Offline - Suas altera√ß√µes ser√£o sincronizadas quando voltar online
    </div>
    
    <div class="container">
        <div class="header">
            <img src="logo-athenea.png" alt="Logo Academia Athenea" class="logo">
            <h1>Check List Reformas, Servi√ßos e Consertos - Academia Athenea</h1>
        </div>
        
        <!-- Sistema de Busca e Filtros -->
        <div class="search-filter-container">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Buscar tarefas..." />
                <span class="search-icon">üîç</span>
            </div>
            
            <div class="filter-buttons">
                <button class="filter-btn" id="filterAll" onclick="filterTasks('all')">Todas</button>
                <button class="filter-btn urgente" id="filterUrgent" onclick="filterTasks('urgente')">Urgentes</button>
                <button class="filter-btn concluidas" id="filterCompleted" onclick="filterTasks('concluidas')">Conclu√≠das</button>
                <button class="filter-btn" id="filterPending" onclick="filterTasks('pendentes')">Pendentes</button>
            </div>
            
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-number" id="statTotal">0</div>
                    <div class="stat-label">Total</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statCompleted">0</div>
                    <div class="stat-label">Conclu√≠das</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statPending">0</div>
                    <div class="stat-label">Pendentes</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statPercent">0%</div>
                    <div class="stat-label">Progresso</div>
                </div>
            </div>
        </div>
        
        <!-- Bot√µes de Exporta√ß√£o -->
        <div class="export-container">
            <button class="export-btn pdf" onclick="exportToPDF()">
                üìÑ Exportar PDF
            </button>
            <button class="export-btn excel" onclick="exportToExcel()">
                üìä Exportar Excel
            </button>
        </div>
        
        <!-- √Årea de Gr√°ficos -->
        <div class="charts-container">
            <h2 style="text-align: center; color: #2c3e50; margin-bottom: 10px;">üìä Dashboard Visual</h2>
            
            <div class="charts-grid">
                <div class="chart-box">
                    <div class="chart-title">Progresso Geral</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="progressBar">0%</div>
                    </div>
                </div>
                
                <div class="chart-box">
                    <div class="chart-title">Distribui√ß√£o de Tarefas</div>
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
        </div>
        
        <div class="legend">
            <span class="legend-icon">1</span>
            <span class="legend-text">Os n√∫meros laranjas indicam a ordem de prioridade das a√ß√µes mais importantes</span>
        </div>
        
        <table>
            <thead>
                <tr>
                    <th>A√ß√£o</th>
                    <th style="width: 150px;">Prioridade</th>
                    <th class="text-cell">Respons√°vel</th>
                    <th class="text-cell">Observa√ß√µes</th>
                </tr>
            </thead>
            <tbody>
                <!-- Fossa -->
                <tr>
                    <td colspan="5" class="section-header">Fossa</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="fossa1"> 
                        <label for="fossa1"><span class="priority-badge">1</span>Limpar toda a fossa (Servi√ßo Terceirizado)</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="fossa1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente" selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="fossa1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="fossa1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="fossa2"> 
                        <label for="fossa2"><span class="priority-badge">2</span>Fazer a Tampa fossa</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="fossa2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente" selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="fossa2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="fossa2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                
                <!-- El√©trica -->
                <tr>
                    <td colspan="5" class="section-header">El√©trica</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="eletrica1"> 
                        <label for="eletrica1"><span class="priority-badge">3</span>Conserto da caixa de energia e cabos do poste</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="fossa1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="eletrica1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="eletrica1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="materials-header">Materiais:</td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="eletrica-mat1"> 
                        <label for="eletrica-mat1">1 Caixa de med. trif. polic. p/ dps cdm3 p6</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="eletrica-mat2"> 
                        <label for="eletrica-mat2">1 Medidor eletronico monof. din 50a sibra</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="eletrica-mat3"> 
                        <label for="eletrica-mat3">1 Disjuntor bif. din 50a-c tramontina</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="eletrica-mat4"> 
                        <label for="eletrica-mat4">3 Protetor c. surtos s1-c 10a 20 ka sibrat</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="eletrica-mat5"> 
                        <label for="eletrica-mat5">1 Haste terra cobre 5/8 12,0mm x 2,00m</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="eletrica-mat6"> 
                        <label for="eletrica-mat6">1 Conector p/ haste 1/2 (13mm) 25-35mm t</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="eletrica-mat7"> 
                        <label for="eletrica-mat7">1 Caixa de aterramento pvc red. pq</label>
                    </td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="eletrica2"> 
                        <label for="eletrica2"><span class="priority-badge">21</span>Consertar tomadas, l√¢mpadas e fia√ß√µes (banheiro, peregrinos, cozinha, refeit√≥rio, lavanderia etc)</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="eletrica2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="eletrica2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="eletrica2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="eletrica3"> 
                        <label for="eletrica3">Instalar refletores estacionamento e Cristo</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="eletrica3-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="eletrica3-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="eletrica3-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                
                <!-- Telhado banheiro -->
                <tr>
                    <td colspan="5" class="section-header">Telhado banheiro</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="telhado2"> 
                        <label for="telhado2"><span class="priority-badge">4</span>Madeiramento telhado banheiros</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="telhado2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="telhado2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="telhado2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="materials-header">Materiais:</td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="telhado-mat1"> 
                        <label for="telhado-mat1">10 comunheira telhado</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="telhado-mat2"> 
                        <label for="telhado-mat2">16 ripas de 10cms de 3m</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="telhado-mat3"> 
                        <label for="telhado-mat3">5 ripas de 5cm de 3m</label>
                    </td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="telhado1"> 
                        <label for="telhado1">Terminar pilastra</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="telhado1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="telhado1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="telhado1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                
                <!-- Pia parte de Fora -->
                <tr>
                    <td colspan="5" class="section-header">Pia parte de Fora</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="pia1"> 
                        <label for="pia1"><span class="priority-badge">5</span>Trocar pia de fora pela doada</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="pia1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="pia1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="pia1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="pia2"> 
                        <label for="pia2"><span class="priority-badge">6</span>Trocar sif√£o do tanque (vazando)</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="pia2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="pia2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="pia2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="materials-header">Materiais:</td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="pia-mat1"> 
                        <label for="pia-mat1">Comprar 2 joelhos para a pia</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="pia-mat2"> 
                        <label for="pia-mat2">Trocar c√≠f√£o do tanque (vazando)</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="pia-mat3"> 
                        <label for="pia-mat3">Comprar 3m de cano 40</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="pia-mat4"> 
                        <label for="pia-mat4">Comprar 1 T de cano</label>
                    </td>
                </tr>
<!-- Reformar Banheiros -->
                <tr>
                    <td colspan="5" class="section-header">Reformar banheiros (F e M)</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="banheiro2"> 
                        <label for="banheiro2"><span class="priority-badge">7</span>Colocar piso e azulejo em √°reas faltantes</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="banheiro2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="banheiro2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="banheiro2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="banheiro3"> 
                        <label for="banheiro3"><span class="priority-badge">8</span>Rebocar e passar massa banheiros masculino</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="banheiro3-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="banheiro3-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="banheiro3-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="banheiro4"> 
                        <label for="banheiro4"><span class="priority-badge">9</span>Pintar banheiros masculino e feminino</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="banheiro4-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="banheiro4-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="banheiro4-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="banheiro5"> 
                        <label for="banheiro5"><span class="priority-badge">10</span>Trocar kit acionador de caixas acopladas 2 vasos sanit√°rios</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="banheiro5-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="banheiro5-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="banheiro5-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="banheiro6"> 
                        <label for="banheiro6"><span class="priority-badge">11</span>Instalar 2 chuveiros</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="banheiro6-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="banheiro6-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="banheiro6-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="materials-header">Materiais:</td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="banheiro-mat1"> 
                        <label for="banheiro-mat1">1 Puxador</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="banheiro-mat2"> 
                        <label for="banheiro-mat2">10 Targetas (trincos)</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="banheiro-mat3"> 
                        <label for="banheiro-mat3">10 Cadeados</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="banheiro-mat4"> 
                        <label for="banheiro-mat4">2 Chuveiros el√©trico</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="banheiro-mat5"> 
                        <label for="banheiro-mat5">2 Kits de Caixa acoplada vaso sanitario</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="banheiro-mat6"> 
                        <label for="banheiro-mat6">Rejunte</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="banheiro-mat7"> 
                        <label for="banheiro-mat7">Reboco e massa corrida</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="banheiro-mat8"> 
                        <label for="banheiro-mat8">Azulejos nos Banheiros</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="banheiro-mat9"> 
                        <label for="banheiro-mat9">Piso nos Banheiros</label>
                    </td>
                </tr>
                
                
                
                <!-- Forro faltando -->
                <tr>
                    <td colspan="5" class="section-header">Forro faltando quarto casal (Cozinha)</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="forro1"> 
                        <label for="forro1"><span class="priority-badge">12</span>Instalar forro</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="forro1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="forro1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="forro1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="materials-header">Materiais:</td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="forro-mat1"> 
                        <label for="forro-mat1">1 Pe√ßa de forro</label>
                    </td>
                </tr>
                
                
                
<!-- Colch√µes - Peregrinos Casal e Solteiro (M e F) -->
                <tr>
                    <td colspan="5" class="section-header">Colch√µes - Peregrinos Casal e Solteiro (M e F)</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="colchao2"> 
                        <label for="colchao2"><span class="priority-badge">13</span>Tirar mofo e secar colch√µes</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="colchao2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="colchao2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="colchao2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="colchao1"> 
                        <label for="colchao1"><span class="priority-badge">14</span>Encapar colch√µes</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="colchao1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="colchao1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="colchao1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="materials-header">Materiais:</td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="colchao-mat1"> 
                        <label for="colchao-mat1">4 Capas para os colchoes casal</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="colchao-mat2"> 
                        <label for="colchao-mat2">1 capa colch√£o casal grosso</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="colchao-mat3"> 
                        <label for="colchao-mat3">5 Capas colch√£o solteiro</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="colchao-mat4"> 
                        <label for="colchao-mat4">1 capa colch√£o solteiro grosso</label>
                    </td>
                </tr>
                
                <!-- Tarefas prepara√ß√£o Curso Agrocultura -->
                <tr>
                    <td colspan="5" class="section-header">Tarefas prepara√ß√£o Curso Agrocultura</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="agrocultura1"> 
                        <label for="agrocultura1"><span class="priority-badge">15</span>Consertar carrinhos de m√£o</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="agrocultura1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="agrocultura1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="agrocultura1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="agrocultura2"> 
                        <label for="agrocultura2"><span class="priority-badge">16</span>Consertar ferramentas de campo</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="agrocultura2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="agrocultura2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="agrocultura2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                
<!-- Limpezas e Pinturas -->
                <tr>
                    <td colspan="5" class="section-header">Limpezas e Pinturas</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="limpeza1"> 
                        <label for="limpeza1"><span class="priority-badge">18</span>Limpar canaleta que escorre √°gua para a Athenea e ambiente entre Cozinha e Estufa</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="limpeza1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="limpeza1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="limpeza1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="limpeza2"> 
                        <label for="limpeza2"><span class="priority-badge">17</span>Instalar varais na Lavanderia ao Lado do Banheiro Feminino</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="limpeza2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="limpeza2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="limpeza2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="limpeza3"> 
                        <label for="limpeza3"><span class="priority-badge">30</span>Limpeza atr√°s dos banheiros (tirar entulhos)</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="limpeza3-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="limpeza3-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="limpeza3-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="limpeza6"> 
                        <label for="limpeza6">Limpar caixa d'√°gua</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="limpeza6-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="limpeza6-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="limpeza6-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
<!-- Varais √°ereos Lavanderia devido ao Curso (itens pertencem √† se√ß√£o Limpezas) -->
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="curso1"> 
                        <label for="curso1"><span class="priority-badge">25</span>Limpeza e rejunte escada da Academia</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="curso1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="curso1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="curso1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="curso2"> 
                        <label for="curso2"><span class="priority-badge">26</span>Retirada dos limos, manchas de sujeira</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="curso2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="curso2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="curso2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="limpeza4"> 
                        <label for="limpeza4"><span class="priority-badge">20</span>Limpar e pintar Faixada entrada Athenea</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="limpeza4-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="limpeza4-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="limpeza4-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="limpeza5"> 
                        <label for="limpeza5"><span class="priority-badge">19</span>Pintura antec√¢mara e sala de vestes Zeus</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="limpeza5-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="limpeza5-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="limpeza5-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
<!-- Lago -->
                <tr>
                    <td colspan="5" class="section-header">Lago</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="lago1"> 
                        <label for="lago1"><span class="priority-badge">22</span>Limpar Lago</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="lago1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="lago1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="lago1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="lago2"> 
                        <label for="lago2">Expandir area do Lago</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="lago2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="lago2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="lago2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
<!-- Santu√°rio de Cura -->
                <tr>
                    <td colspan="5" class="section-header">Santu√°rio de Cura</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="santuario1"> 
                        <label for="santuario1">Reboco de parede santu√°rio de cura que est√° esfarelando</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="santuario1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="santuario1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="santuario1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="santuario3"> 
                        <label for="santuario3"><span class="priority-badge">23</span>Limpar e Podar a estrada at√© o Santu√°rio</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="santuario3-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="santuario3-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="santuario3-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="santuario4"> 
                        <label for="santuario4">Restaurar Jardim de inverno</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="santuario4-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="santuario4-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="santuario4-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="santuario5"> 
                        <label for="santuario5">Tirar o mofo da m√£e divina e resin√°-la</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="santuario5-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="santuario5-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="santuario5-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="santuario6"> 
                        <label for="santuario6"><span class="priority-badge">24</span>Tirar mofo e limpar c√∫pula de vidro</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="santuario6-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="santuario6-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="santuario6-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="santuario2"> 
                        <label for="santuario2">Utens√≠lios de limpeza para o Santu√°rio de Cura</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="santuario2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="santuario2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="santuario2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="materials-header">Materiais:</td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="santuario-mat1"> 
                        <label for="santuario-mat1">Ma√ßarico</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="santuario-mat2"> 
                        <label for="santuario-mat2">Vassoura esfreg√£o</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="santuario-mat3"> 
                        <label for="santuario-mat3">Rodo gde</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="santuario-mat4"> 
                        <label for="santuario-mat4">Pano gde</label>
                    </td>
                </tr>
<!-- Ver sujeira caindo teto -->
                <tr>
                    <td colspan="5" class="section-header">Casa Peregrino de Casais</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="teto1"> 
                        <label for="teto1"><span class="priority-badge">27</span>Verificar e corrigir sujeira caindo do teto</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="teto1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="teto1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="teto1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
<!-- √Årea externa -->
                <tr>
                    <td colspan="5" class="section-header">√Årea externa</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="externa1"> 
                        <label for="externa1"><span class="priority-badge">28</span>Coloca√ß√£o de mour√µes na entrada</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="externa1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="externa1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="externa1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="externa2"> 
                        <label for="externa2"><span class="priority-badge">29</span>Corrigir burac√£o de lodo na grama (usar areia ao lado do Zeus)</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="externa2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="externa2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="externa2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="externa3"> 
                        <label for="externa3"><span class="priority-badge">31</span>Levar os lixos, entulhos e velharias na Carretinha</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="externa3-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="externa3-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="externa3-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="externa4"> 
                        <label for="externa4">Nivelar e cimentar cal√ßada atr√°s da antec√¢mara parte de fora</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="externa4-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="externa4-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="externa4-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="externa5"> 
                        <label for="externa5">Paisagismo Cristo e Athenea</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="externa5-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="externa5-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="externa5-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="externa6"> 
                        <label for="externa6">Limpeza com a m√£o das brom√©lias e babosa (pr√≥ximo casinha ferramentas)</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="externa6-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="externa6-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="externa6-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="externa7"> 
                        <label for="externa7">Podar algumas folhas das palmeiras</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="externa7-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="externa7-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="externa7-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
<!-- Cozinha -->
                <tr>
                    <td colspan="5" class="section-header">Cozinha</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="cozinha1"> 
                        <label for="cozinha1">Instalar janela</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="cozinha1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="cozinha1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="cozinha1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="cozinha2"> 
                        <label for="cozinha2">Comprar liquidificador</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="cozinha2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="cozinha2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="cozinha2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="materials-header">Materiais:</td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="cozinha-mat1"> 
                        <label for="cozinha-mat1">Janela pro v√£o da cozinha</label>
                    </td>
                </tr>
                <tr class="materials-section">
                    <td colspan="5" class="material-item">
                        <input type="checkbox" id="cozinha-mat2"> 
                        <label for="cozinha-mat2">1 Liquidificador Industrial</label>
                    </td>
                </tr>

                
                
                
                <!-- Fazer parapeito -->
                <tr>
                    <td colspan="5" class="section-header">Fazer parapeito no andar dos banheiros</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="parapeito1"> 
                        <label for="parapeito1">Construir parapeito</label>
                    </td>
                    <td>
                        <select class="priority-dropdown nao-urgente" id="parapeito1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente">Urgente</option>
                            <option value="nao-urgente" selected>N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="parapeito1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="parapeito1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                
                
                
                <!-- Mutir√£o Pr√©-Evento dia 26/10 -->
                <tr>
                    <td colspan="5" class="section-header section-header-mutirao">Mutir√£o Pr√©-Evento dia 26/10</td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao1"> 
                        <label for="mutirao1">Limpeza dos peregrinos masculinos e feminino</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao1-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao1-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao1-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao2"> 
                        <label for="mutirao2">Limpeza dos banheiros masculino e feminino</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao2-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao2-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao2-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao3"> 
                        <label for="mutirao3">Limpeza dos peregrinos de casal</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao3-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao3-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao3-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao4"> 
                        <label for="mutirao4">Corte da grama</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao4-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao4-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao4-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao5"> 
                        <label for="mutirao5">Rastelagem das folhas secas</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao5-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao5-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao5-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao6"> 
                        <label for="mutirao6">Limpeza da cozinha e refeit√≥rio</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao6-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao6-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao6-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao7"> 
                        <label for="mutirao7">Prepara√ß√£o Almo√ßo Mutir√£o</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao7-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao7-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao7-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao8"> 
                        <label for="mutirao8">Compras mercado evento</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao8-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao8-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao8-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao9"> 
                        <label for="mutirao9">Crach√°s+cartazes</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao9-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao9-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao9-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
                <tr>
                    <td class="action-cell">
                        <input type="checkbox" id="mutirao10"> 
                        <label for="mutirao10">Cozinhar na Conviv√™ncia Estadual</label>
                    </td>
                    <td>
                        <select class="priority-dropdown urgente" id="mutirao10-prioridade">
                            <option value="">Selecione...</option>
                            <option value="urgente"selected>Urgente</option>
                            <option value="nao-urgente">N√£o Urgente</option>
                        </select>
                    </td>
                    <td class="text-cell"><textarea id="mutirao10-responsavel" placeholder="Nome do respons√°vel" rows="1"></textarea></td>
                    <td class="text-cell"><textarea id="mutirao10-observacoes" placeholder="Observa√ß√µes" rows="1"></textarea></td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ============================================
        // SERVICE WORKER - MODO OFFLINE
        // ============================================
        
        // Registrar Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado:', registration.scope);
                        
                        // Verificar atualiza√ß√µes
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('üîÑ Nova vers√£o do Service Worker encontrada!');
                            
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // Nova vers√£o dispon√≠vel
                                    if (confirm('Nova vers√£o dispon√≠vel! Atualizar agora?')) {
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.error('‚ùå Erro ao registrar Service Worker:', error);
                    });
            });
        } else {
            console.warn('‚ö†Ô∏è Service Worker n√£o suportado neste navegador');
        }
        
        // ============================================
        // CONFIGURA√á√ÉO SUPABASE
        // ============================================
        // Voc√™ precisa substituir esses valores pelos seus do Supabase:
        // 1. V√° em: https://supabase.com/dashboard/project/SEU_PROJETO/settings/api
        // 2. Copie a "Project URL" e a "anon public key"
        
        const SUPABASE_URL = 'https://vxhohdxqdrfkqtmhflhy.supabase.co';  // ‚¨ÖÔ∏è SUBSTITUA AQUI
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZ4aG9oZHhxZHJma3F0bWhmbGh5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjAwOTg1MTAsImV4cCI6MjA3NTY3NDUxMH0.r0RCPQdIm_tAUWzWlZ-BxYqnIetOt-J2m99WXGZIS0k';      // ‚¨ÖÔ∏è SUBSTITUA AQUI
        
        // Verificar se est√° configurado
        const isConfigured = !SUPABASE_URL.includes('SEU_PROJETO');
        
        let supabase = null;
        let syncChannel = null;
        let textChannel = null;
        let sizeChannel = null;
        
        if (isConfigured) {
            supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
            console.log('‚úÖ Supabase conectado!');
        } else {
            console.log('‚ö†Ô∏è Configure o Supabase! Veja INSTRUCOES_SUPABASE.md');
        }
        
        // ============================================
        // OTIMIZA√á√ïES DE PERFORMANCE
        // ============================================
        
        // Debounce - evita execu√ß√£o excessiva de fun√ß√µes
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
        
        // Throttle - limita frequ√™ncia de execu√ß√£o
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                if (!inThrottle) {
                    func.apply(this, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            };
        }
        
        // Lazy loading de imagens
        function setupLazyLoading() {
            const images = document.querySelectorAll('img[data-src]');
            
            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        observer.unobserve(img);
                    }
                });
            });
            
            images.forEach(img => imageObserver.observe(img));
        }
        
        // Otimizar scroll com RequestAnimationFrame
        let ticking = false;
        function optimizedScroll(callback) {
            if (!ticking) {
                window.requestAnimationFrame(() => {
                    callback();
                    ticking = false;
                });
                ticking = true;
            }
        }
        
        // Cache de consultas DOM
        const domCache = new Map();
        function getCachedElement(selector) {
            if (!domCache.has(selector)) {
                domCache.set(selector, document.querySelector(selector));
            }
            return domCache.get(selector);
        }
        
        // ============================================
        // FUN√á√ïES DE GERENCIAMENTO DE CHECKBOXES
        // ============================================
        
        // Adicionar IDs √∫nicos aos checkboxes que n√£o t√™m ID
        function addUniqueIds() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            let counter = 0;
            checkboxes.forEach(checkbox => {
                if (!checkbox.id) {
                    checkbox.id = 'checkbox-' + counter;
                    counter++;
                }
            });
        }
        
        // Salvar estado no Supabase (sincroniza√ß√£o IMEDIATA)
        async function saveCheckboxState(checkboxId, checked) {
            console.log(`üíæ Salvando ${checkboxId}: ${checked}`);
            showSavingIndicator(); // Feedback visual instant√¢neo
            
            if (!isConfigured || !supabase) {
                // Fallback para localStorage se n√£o configurado
                localStorage.setItem(checkboxId, checked);
                hideSavingIndicator();
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('checkboxes')
                    .upsert({ 
                        id: checkboxId, 
                        checked: checked,
                        updated_at: new Date().toISOString()
                    }, { 
                        onConflict: 'id' 
                    });
                
                if (error) {
                    console.error('‚ùå Erro ao salvar checkbox:', error.message);
                    // Fallback para localStorage
                    localStorage.setItem(checkboxId, checked);
                    showErrorIndicator();
                } else {
                    console.log(`‚úÖ Checkbox ${checkboxId} salvo com sucesso`);
                    showSuccessIndicator();
                }
            } catch (error) {
                console.error('‚ùå Erro ao salvar checkbox:', error);
                localStorage.setItem(checkboxId, checked);
                showErrorIndicator();
            }
            
            setTimeout(hideSavingIndicator, 1000);
        }
        
        // Carregar estado do Supabase
        async function loadCheckboxState(checkboxId) {
            if (!isConfigured || !supabase) {
                // Fallback para localStorage
                const savedState = localStorage.getItem(checkboxId);
                return savedState === 'true';
            }
            
            try {
                const { data, error } = await supabase
                    .from('checkboxes')
                    .select('checked')
                    .eq('id', checkboxId)
                    .maybeSingle();
                
                if (error) {
                    console.error(`‚ùå Erro ao carregar ${checkboxId}:`, error.message);
                    const savedState = localStorage.getItem(checkboxId);
                    return savedState === 'true';
                }
                
                if (data) {
                    console.log(`üì• Carregado ${checkboxId}: ${data.checked}`);
                    return data.checked;
                }
                
                return null;
            } catch (error) {
                console.error('‚ùå Erro ao carregar checkbox:', error);
                const savedState = localStorage.getItem(checkboxId);
                return savedState === 'true';
            }
        }
        
        // Restaurar estados de todos os checkboxes - OTIMIZADO (batch loading)
        async function restoreCheckboxStates() {
            console.log('üîÑ Restaurando estados dos checkboxes...');
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            
            if (!isConfigured || !supabase) {
                // Modo offline: carregar do localStorage
                console.log('üì¶ Carregando do localStorage (modo offline)...');
                checkboxes.forEach(checkbox => {
                    if (checkbox.id) {
                        const saved = localStorage.getItem(checkbox.id);
                        if (saved === 'true') {
                            checkbox.checked = true;
                            toggleTaskCompletion(checkbox);
                        }
                    }
                });
                console.log('‚úÖ Checkboxes carregados do localStorage');
                return;
            }
            
            try {
                // OTIMIZA√á√ÉO: Carregar TODOS de uma vez (batch)
                const { data, error } = await supabase
                    .from('checkboxes')
                    .select('id, checked');
                
                if (error) throw error;
                
                // Criar Map para lookup r√°pido O(1)
                const stateMap = new Map(data.map(item => [item.id, item.checked]));
                
                let loaded = 0;
                checkboxes.forEach(checkbox => {
                    if (checkbox.id && stateMap.has(checkbox.id)) {
                        const checked = stateMap.get(checkbox.id);
                        checkbox.checked = checked;
                        loaded++;
                        
                        if (checked) {
                            toggleTaskCompletion(checkbox);
                        }
                    }
                });
                
                console.log(`‚úÖ ${loaded} checkboxes restaurados em batch`);
            } catch (error) {
                console.error('‚ùå Erro ao carregar checkboxes:', error);
                // Fallback para localStorage
                checkboxes.forEach(checkbox => {
                    if (checkbox.id) {
                        const saved = localStorage.getItem(checkbox.id);
                        if (saved === 'true') {
                            checkbox.checked = true;
                            toggleTaskCompletion(checkbox);
                        }
                    }
                });
            }
        }
        
        // ============================================
        // FUN√á√ïES PARA CAMPOS DE TEXTO
        // ============================================
        
        // Salvar campo de texto no Supabase (sincroniza√ß√£o r√°pida)
        async function saveTextField(fieldId, value) {
            console.log(`üíæ Salvando texto ${fieldId}`);
            showSavingIndicator();
            
            if (!isConfigured || !supabase) {
                localStorage.setItem(fieldId, value);
                hideSavingIndicator();
                return;
            }
            
            try {
                const { data, error} = await supabase
                    .from('text_fields')
                    .upsert({ 
                        id: fieldId, 
                        value: value,
                        updated_at: new Date().toISOString()
                    }, { 
                        onConflict: 'id' 
                    });
                
                if (error) {
                    console.error('‚ùå Erro ao salvar texto:', error.message);
                    localStorage.setItem(fieldId, value);
                    showErrorIndicator();
                } else {
                    console.log(`‚úÖ Texto ${fieldId} salvo`);
                    showSuccessIndicator();
                }
            } catch (error) {
                console.error('‚ùå Erro ao salvar texto:', error);
                localStorage.setItem(fieldId, value);
                showErrorIndicator();
            }
            
            setTimeout(hideSavingIndicator, 1000);
        }
        
        // Carregar campo de texto do Supabase
        async function loadTextField(fieldId) {
            if (!isConfigured || !supabase) {
                return localStorage.getItem(fieldId) || '';
            }
            
            try {
                const { data, error } = await supabase
                    .from('text_fields')
                    .select('value')
                    .eq('id', fieldId)
                    .maybeSingle();
                
                if (error) {
                    console.error(`‚ùå Erro ao carregar texto ${fieldId}:`, error.message);
                    return localStorage.getItem(fieldId) || '';
                }
                
                return data ? data.value : '';
            } catch (error) {
                console.error('‚ùå Erro ao carregar texto:', error);
                return localStorage.getItem(fieldId) || '';
            }
        }
        
        // Restaurar todos os campos de texto
        // Restaurar campos de texto - OTIMIZADO (batch loading)
        async function restoreTextFields() {
            console.log('üîÑ Restaurando campos de texto...');
            const textInputs = document.querySelectorAll('input[type="text"], textarea');
            
            if (!isConfigured || !supabase) {
                // Modo offline: carregar do localStorage
                textInputs.forEach(input => {
                    if (input.id) {
                        const saved = localStorage.getItem(input.id);
                        if (saved) input.value = saved;
                    }
                });
                console.log('‚úÖ Campos carregados do localStorage');
                return;
            }
            
            try {
                // OTIMIZA√á√ÉO: Carregar TODOS de uma vez
                const { data, error } = await supabase
                    .from('text_fields')
                    .select('id, value');
                
                if (error) throw error;
                
                // Map para lookup r√°pido
                const valueMap = new Map(data.map(item => [item.id, item.value]));
                
                let loaded = 0;
                textInputs.forEach(input => {
                    if (input.id && valueMap.has(input.id)) {
                        input.value = valueMap.get(input.id);
                        loaded++;
                    }
                });
                
                console.log(`‚úÖ ${loaded} campos de texto restaurados em batch`);
            } catch (error) {
                console.error('‚ùå Erro ao carregar campos:', error);
                // Fallback localStorage
                textInputs.forEach(input => {
                    if (input.id) {
                        const saved = localStorage.getItem(input.id);
                        if (saved) input.value = saved;
                    }
                });
            }
        }
        
        // ============================================
        // SALVAR E RESTAURAR TAMANHO DOS CAMPOS
        // ============================================
        
        // Salvar tamanho do campo (largura e altura)
        async function saveFieldSize(fieldId, width, height) {
            const sizeData = { width, height };
            
            if (!isConfigured) {
                localStorage.setItem(fieldId + '-size', JSON.stringify(sizeData));
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('field_sizes')
                    .upsert({ 
                        id: fieldId, 
                        width: width,
                        height: height,
                        updated_at: new Date().toISOString()
                    }, { 
                        onConflict: 'id' 
                    });
                
                if (error) {
                    console.error('Erro ao salvar tamanho:', error);
                    localStorage.setItem(fieldId + '-size', JSON.stringify(sizeData));
                }
            } catch (error) {
                console.error('Erro ao salvar tamanho:', error);
                localStorage.setItem(fieldId + '-size', JSON.stringify(sizeData));
            }
        }
        
        // Carregar tamanho do campo
        async function loadFieldSize(fieldId) {
            if (!isConfigured) {
                const saved = localStorage.getItem(fieldId + '-size');
                return saved ? JSON.parse(saved) : null;
            }
            
            try {
                const { data, error } = await supabase
                    .from('field_sizes')
                    .select('width, height')
                    .eq('id', fieldId)
                    .single();
                
                if (error && error.code !== 'PGRST116') {
                    console.error('Erro ao carregar tamanho:', error);
                    const saved = localStorage.getItem(fieldId + '-size');
                    return saved ? JSON.parse(saved) : null;
                }
                
                return data ? { width: data.width, height: data.height } : null;
            } catch (error) {
                console.error('Erro ao carregar tamanho:', error);
                const saved = localStorage.getItem(fieldId + '-size');
                return saved ? JSON.parse(saved) : null;
            }
        }
        
        // Restaurar tamanhos de todos os campos
        // Restaurar tamanhos dos campos - OTIMIZADO (batch loading)
        async function restoreFieldSizes() {
            const textareas = document.querySelectorAll('textarea');
            
            if (!isConfigured || !supabase) {
                // Modo offline: carregar do localStorage
                textareas.forEach(textarea => {
                    if (textarea.id) {
                        const saved = localStorage.getItem(textarea.id + '-size');
                        if (saved) {
                            const size = JSON.parse(saved);
                            textarea.style.width = size.width + 'px';
                            textarea.style.height = size.height + 'px';
                        }
                    }
                });
                return;
            }
            
            try {
                // OTIMIZA√á√ÉO: Carregar TODOS de uma vez
                const { data, error } = await supabase
                    .from('field_sizes')
                    .select('id, width, height');
                
                if (error) {
                    // Se tabela n√£o existe, mostrar aviso
                    if (error.code === 'PGRST205') {
                        console.warn('‚ö†Ô∏è ATEN√á√ÉO: Tabela field_sizes n√£o existe no Supabase!');
                        console.warn('üìö Execute o script: supabase-tables.sql');
                        addNotification(
                            '‚ö†Ô∏è Configura√ß√£o Incompleta',
                            'Tabela field_sizes n√£o encontrada. Execute supabase-tables.sql no Supabase Dashboard.',
                            'warning'
                        );
                    }
                    throw error;
                }
                
                // Map para lookup r√°pido
                const sizeMap = new Map(data.map(item => [item.id, { width: item.width, height: item.height }]));
                
                textareas.forEach(textarea => {
                    if (textarea.id && sizeMap.has(textarea.id)) {
                        const size = sizeMap.get(textarea.id);
                        textarea.style.width = size.width + 'px';
                        textarea.style.height = size.height + 'px';
                    }
                });
                
                console.log(`‚úÖ Tamanhos restaurados em batch`);
            } catch (error) {
                console.error('‚ùå Erro ao carregar tamanhos:', error);
                // Fallback localStorage
                textareas.forEach(textarea => {
                    if (textarea.id) {
                        const saved = localStorage.getItem(textarea.id + '-size');
                        if (saved) {
                            const size = JSON.parse(saved);
                            textarea.style.width = size.width + 'px';
                            textarea.style.height = size.height + 'px';
                        }
                    }
                });
            }
        }
        
        // Configurar listeners para detectar redimensionamento
        function setupResizeListeners() {
            const textareas = document.querySelectorAll('textarea');
            
            textareas.forEach(textarea => {
                // Usar ResizeObserver para detectar mudan√ßas de tamanho
                const resizeObserver = new ResizeObserver(entries => {
                    for (let entry of entries) {
                        const width = entry.contentRect.width;
                        const height = entry.contentRect.height;
                        
                        // Salvar com debounce
                        clearTimeout(textarea.resizeTimeout);
                        textarea.resizeTimeout = setTimeout(() => {
                            saveFieldSize(textarea.id, width, height);
                        }, 500);
                    }
                });
                
                resizeObserver.observe(textarea);
            });
        }
        
        // Sincroniza√ß√£o em tempo real para tamanhos
        function setupFieldSizeRealtimeSync() {
            if (!isConfigured) return;
            
            const channel = supabase
                .channel('field-sizes-changes')
                .on('postgres_changes', 
                    { 
                        event: '*', 
                        schema: 'public', 
                        table: 'field_sizes' 
                    }, 
                    (payload) => {
                        console.log('Mudan√ßa de tamanho detectada:', payload);
                        const field = document.getElementById(payload.new.id);
                        if (field) {
                            field.style.width = payload.new.width + 'px';
                            field.style.height = payload.new.height + 'px';
                        }
                    }
                )
                .subscribe();
        }
        
        // Configurar listeners para campos de texto
        function setupTextFieldListeners() {
            const textInputs = document.querySelectorAll('input[type="text"], textarea');
            
            textInputs.forEach(input => {
                // Debounce para evitar salvar a cada tecla (reduzido para 300ms = mais r√°pido)
                let timeout = null;
                
                input.addEventListener('input', function() {
                    clearTimeout(timeout);
                    timeout = setTimeout(() => {
                        saveTextField(this.id, this.value);
                    }, 300); // Aguarda 300ms ap√≥s parar de digitar (antes era 500ms)
                });
                
                // Salvar imediatamente quando sair do campo
                input.addEventListener('blur', function() {
                    clearTimeout(timeout);
                    saveTextField(this.id, this.value);
                });
            });
        }
        
        // Sincroniza√ß√£o em tempo real para campos de texto
        function setupTextFieldRealtimeSync() {
            if (!isConfigured) return;
            
            const channel = supabase
                .channel('text-fields-changes')
                .on('postgres_changes', 
                    { 
                        event: '*', 
                        schema: 'public', 
                        table: 'text_fields' 
                    }, 
                    (payload) => {
                        console.log('Mudan√ßa de texto detectada:', payload);
                        const field = document.getElementById(payload.new.id);
                        if (field && field !== document.activeElement && field.value !== payload.new.value) {
                            field.value = payload.new.value;
                        }
                    }
                )
                .subscribe();
        }
        
        // Configurar listeners para mudan√ßas
        function setupCheckboxListeners() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    saveCheckboxState(this.id, this.checked);
                    
                    // Riscar ou desriscar o texto da tarefa
                    toggleTaskCompletion(this);
                });
            });
        }
        
        // Fun√ß√£o para riscar/desriscar texto quando marcar/desmarcar
        function toggleTaskCompletion(checkbox) {
            const label = checkbox.nextElementSibling;
            if (!label) return;
            
            if (checkbox.checked) {
                label.classList.add('task-completed');
                
                // Notificar conclus√£o de tarefa
                const taskText = label.textContent.trim();
                const shortText = taskText.length > 40 ? taskText.substring(0, 40) + '...' : taskText;
                addNotification(
                    '‚úÖ Tarefa Conclu√≠da!',
                    shortText,
                    'success'
                );
                
                // Verificar marcos de progresso
                setTimeout(() => checkProgressMilestones(), 500);
            } else {
                label.classList.remove('task-completed');
            }
        }
        
        // ============================================
        // FUN√á√ïES PARA DROPDOWNS DE PRIORIDADE
        // ============================================
        
        // Salvar prioridade no Supabase
        async function savePriorityDropdown(dropdownId, value) {
            console.log(`üíæ Salvando prioridade ${dropdownId}: ${value}`);
            showSavingIndicator();
            
            if (!isConfigured || !supabase) {
                localStorage.setItem(dropdownId, value);
                hideSavingIndicator();
                return;
            }
            
            try {
                const { data, error } = await supabase
                    .from('priority_dropdowns')  // ‚úÖ CORRIGIDO: usar tabela correta
                    .upsert({ 
                        id: dropdownId, 
                        value: value,
                        updated_at: new Date().toISOString()
                    }, { 
                        onConflict: 'id' 
                    });
                
                if (error) {
                    console.error('‚ùå Erro ao salvar prioridade:', error.message);
                    localStorage.setItem(dropdownId, value);
                    showErrorIndicator();
                } else {
                    console.log(`‚úÖ Prioridade ${dropdownId} salva`);
                    showSuccessIndicator();
                }
            } catch (error) {
                console.error('‚ùå Erro ao salvar prioridade:', error);
                localStorage.setItem(dropdownId, value);
                showErrorIndicator();
            }
            
            setTimeout(hideSavingIndicator, 1000);
        }
        
        // Carregar prioridade do Supabase
        async function loadPriorityDropdown(dropdownId) {
            if (!isConfigured || !supabase) {
                return localStorage.getItem(dropdownId) || '';
            }
            
            try {
                const { data, error } = await supabase
                    .from('priority_dropdowns')  // ‚úÖ CORRIGIDO: usar tabela correta
                    .select('value')
                    .eq('id', dropdownId)
                    .maybeSingle();
                
                if (error) {
                    console.error(`‚ùå Erro ao carregar prioridade ${dropdownId}:`, error.message);
                    return localStorage.getItem(dropdownId) || '';
                }
                
                return data ? data.value : '';
            } catch (error) {
                console.error('‚ùå Erro ao carregar prioridade:', error);
                return localStorage.getItem(dropdownId) || '';
            }
        }
        
        // Configurar listeners para dropdowns de prioridade
        function setupPriorityDropdownListeners() {
            const dropdowns = document.querySelectorAll('.priority-dropdown');
            
            dropdowns.forEach(dropdown => {
                // Aplicar cor inicial baseado no valor atual
                applyPriorityColor(dropdown);
                
                // Atualizar classe CSS baseado no valor selecionado
                dropdown.addEventListener('change', function() {
                    applyPriorityColor(this);
                    // Salvar no banco
                    savePriorityDropdown(this.id, this.value);
                });
            });
        }
        
        // Fun√ß√£o auxiliar para aplicar cor baseado no valor
        function applyPriorityColor(dropdown) {
            // Remover classes antigas
            dropdown.classList.remove('urgente', 'nao-urgente');
            
            // Adicionar nova classe baseada na sele√ß√£o
            // Aceita tanto "urgente" quanto "1" para urgente
            if (dropdown.value === 'urgente' || dropdown.value === '1') {
                dropdown.classList.add('urgente');
            } else if (dropdown.value === 'nao-urgente' || dropdown.value === '2' || dropdown.value === '3' || dropdown.value === '4' || dropdown.value === '5') {
                dropdown.classList.add('nao-urgente');
            }
        }
        
        // Restaurar estados dos dropdowns
        // Restaurar dropdowns de prioridade - OTIMIZADO (batch loading)
        async function restorePriorityDropdowns() {
            console.log('üîÑ Restaurando prioridades...');
            const dropdowns = document.querySelectorAll('.priority-dropdown');
            
            if (!isConfigured || !supabase) {
                // Modo offline: carregar do localStorage
                dropdowns.forEach(dropdown => {
                    if (dropdown.id) {
                        const saved = localStorage.getItem(dropdown.id);
                        if (saved) {
                            dropdown.value = saved;
                            applyPriorityColor(dropdown);
                        }
                    }
                });
                console.log('‚úÖ Prioridades carregadas do localStorage');
                return;
            }
            
            try {
                // OTIMIZA√á√ÉO: Carregar TODOS de uma vez
                const { data, error } = await supabase
                    .from('priority_dropdowns')
                    .select('id, value');
                
                if (error) {
                    // Se tabela n√£o existe, mostrar aviso
                    if (error.code === 'PGRST205') {
                        console.warn('‚ö†Ô∏è ATEN√á√ÉO: Tabela priority_dropdowns n√£o existe no Supabase!');
                        console.warn('üìö Execute o script: supabase-tables.sql');
                        addNotification(
                            '‚ö†Ô∏è Configura√ß√£o Incompleta',
                            'Tabela priority_dropdowns n√£o encontrada. Execute supabase-tables.sql no Supabase Dashboard.',
                            'warning'
                        );
                    }
                    throw error;
                }
                
                // Map para lookup r√°pido
                const valueMap = new Map(data.map(item => [item.id, item.value]));
                
                let loaded = 0;
                dropdowns.forEach(dropdown => {
                    if (dropdown.id && valueMap.has(dropdown.id)) {
                        dropdown.value = valueMap.get(dropdown.id);
                        applyPriorityColor(dropdown);
                        loaded++;
                    }
                });
                
                console.log(`‚úÖ ${loaded} prioridades restauradas em batch`);
            } catch (error) {
                console.error('‚ùå Erro ao carregar prioridades:', error);
                // Fallback localStorage
                dropdowns.forEach(dropdown => {
                    if (dropdown.id) {
                        const saved = localStorage.getItem(dropdown.id);
                        if (saved) {
                            dropdown.value = saved;
                            applyPriorityColor(dropdown);
                        }
                    }
                });
            }
        }
        
        // Sincroniza√ß√£o em tempo real (opcional)
        function setupRealtimeSync() {
            if (!isConfigured || !supabase) return;
            
            console.log('üî¥ Iniciando sincroniza√ß√£o em tempo real...');
            
            syncChannel = supabase
                .channel('checkboxes-changes')
                .on('postgres_changes', 
                    { 
                        event: '*', 
                        schema: 'public', 
                        table: 'checkboxes' 
                    }, 
                    (payload) => {
                        console.log('üì° Mudan√ßa de checkbox detectada:', payload);
                        const checkbox = document.getElementById(payload.new.id);
                        if (checkbox && checkbox.checked !== payload.new.checked) {
                            checkbox.checked = payload.new.checked;
                            console.log(`‚úÖ Checkbox ${payload.new.id} atualizado em tempo real`);
                        }
                    }
                )
                .subscribe((status) => {
                    console.log('üî¥ Status do canal de checkboxes:', status);
                });
        }
        
        // Bot√£o de sincroniza√ß√£o manual
        function addSyncButton() {
            const syncButton = document.createElement('button');
            syncButton.id = 'manual-sync-btn';
            syncButton.innerHTML = 'üîÑ Sincronizar';
            syncButton.style.cssText = `
                position: fixed;
                bottom: 50px;
                right: 10px;
                padding: 10px 20px;
                background: #2196F3;
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-weight: bold;
                box-shadow: 0 2px 5px rgba(0,0,0,0.3);
                z-index: 1001;
            `;
            
            syncButton.addEventListener('click', async () => {
                syncButton.innerHTML = '‚è≥ Sincronizando...';
                syncButton.disabled = true;
                
                try {
                    await restoreCheckboxStates();
                    await restoreTextFields();
                    await restoreFieldSizes();
                    await restorePriorityDropdowns();
                    syncButton.innerHTML = '‚úÖ Sincronizado!';
                    setTimeout(() => {
                        syncButton.innerHTML = 'üîÑ Sincronizar';
                        syncButton.disabled = false;
                    }, 2000);
                } catch (error) {
                    console.error('Erro ao sincronizar:', error);
                    syncButton.innerHTML = '‚ùå Erro';
                    setTimeout(() => {
                        syncButton.innerHTML = 'üîÑ Sincronizar';
                        syncButton.disabled = false;
                    }, 2000);
                }
            });
            
            document.body.appendChild(syncButton);
        }
        
        // ============================================
        // INDICADORES VISUAIS DE SINCRONIZA√á√ÉO
        // ============================================
        
        // Mostrar indicador de salvamento
        function showSavingIndicator() {
            let indicator = document.getElementById('saving-indicator');
            if (!indicator) {
                indicator = document.createElement('div');
                indicator.id = 'saving-indicator';
                indicator.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    padding: 10px 20px;
                    background: #2196F3;
                    color: white;
                    border-radius: 5px;
                    font-weight: bold;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
                    z-index: 10000;
                    display: none;
                    animation: fadeIn 0.3s;
                `;
                document.body.appendChild(indicator);
            }
            indicator.innerHTML = 'üíæ Salvando...';
            indicator.style.display = 'block';
            indicator.style.background = '#2196F3';
        }
        
        // Mostrar indicador de sucesso
        function showSuccessIndicator() {
            const indicator = document.getElementById('saving-indicator');
            if (indicator) {
                indicator.innerHTML = '‚úÖ Salvo!';
                indicator.style.background = '#4CAF50';
            }
        }
        
        // Mostrar indicador de erro
        function showErrorIndicator() {
            const indicator = document.getElementById('saving-indicator');
            if (indicator) {
                indicator.innerHTML = '‚ö†Ô∏è Erro (salvo localmente)';
                indicator.style.background = '#FF9800';
            }
        }
        
        // Esconder indicador
        function hideSavingIndicator() {
            const indicator = document.getElementById('saving-indicator');
            if (indicator) {
                setTimeout(() => {
                    indicator.style.display = 'none';
                }, 500);
            }
        }
        
        // Indicador de status
        function showStatus() {
            const statusDiv = document.createElement('div');
            statusDiv.id = 'connection-status';
            statusDiv.style.cssText = `
                position: fixed; 
                bottom: 10px; 
                right: 10px; 
                padding: 10px 15px; 
                border-radius: 5px; 
                font-size: 12px; 
                font-weight: bold;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                z-index: 1000;
            `;
            
            if (isConfigured && supabase) {
                statusDiv.style.background = '#4CAF50';
                statusDiv.style.color = 'white';
                statusDiv.textContent = 'üåê Online - Sincronizado com Supabase';
                statusDiv.title = 'Dados sendo salvos no banco de dados';
            } else {
                statusDiv.style.background = '#FF9800';
                statusDiv.style.color = 'white';
                statusDiv.textContent = '‚ö†Ô∏è Offline - Apenas Local';
                statusDiv.title = 'Configure o Supabase para sincroniza√ß√£o entre dispositivos';
            }
            
            document.body.appendChild(statusDiv);
        }
        
        // === FUN√á√ïES DE EXPORTA√á√ÉO E GR√ÅFICOS ===
        
        // Vari√°veis globais para os gr√°ficos
        let pieChart = null;
        let barChart = null;
        
        // Fun√ß√£o para exportar para PDF
        function exportToPDF() {
            try {
                console.log('üìÑ Iniciando exporta√ß√£o PDF...');
                
                // Verificar se jsPDF est√° carregado
                if (typeof window.jspdf === 'undefined') {
                    alert('‚ùå Erro: Biblioteca jsPDF n√£o carregada. Recarregue a p√°gina e tente novamente.');
                    console.error('jsPDF n√£o est√° dispon√≠vel');
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // T√≠tulo
                doc.setFontSize(18);
                doc.setFont(undefined, 'bold');
                doc.text('Check List Reformas - Academia Athenea', 105, 20, { align: 'center' });
                
                // Data
                const hoje = new Date().toLocaleDateString('pt-BR');
                doc.setFontSize(10);
                doc.setFont(undefined, 'normal');
                doc.text(`Gerado em: ${hoje}`, 105, 28, { align: 'center' });
                
                // Estat√≠sticas
                const total = document.getElementById('statTotal').textContent;
                const concluidas = document.getElementById('statCompleted').textContent;
                const pendentes = document.getElementById('statPending').textContent;
                const progresso = document.getElementById('statPercent').textContent;
                
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Estat√≠sticas:', 20, 40);
                doc.setFont(undefined, 'normal');
                doc.text(`Total de Tarefas: ${total}`, 20, 48);
                doc.text(`Conclu√≠das: ${concluidas}`, 20, 56);
                doc.text(`Pendentes: ${pendentes}`, 20, 64);
                doc.text(`Progresso: ${progresso}`, 20, 72);
                
                // Linha divis√≥ria
                doc.line(20, 78, 190, 78);
                
                // Tarefas
                let y = 88;
                doc.setFontSize(12);
                doc.setFont(undefined, 'bold');
                doc.text('Tarefas:', 20, y);
                y += 8;
                
                doc.setFontSize(10);
                const rows = document.querySelectorAll('tbody tr:not(.hidden)');
                
                rows.forEach(row => {
                    if (row.querySelector('.section-header')) {
                        // Se√ß√£o
                        if (y > 270) {
                            doc.addPage();
                            y = 20;
                        }
                        doc.setFont(undefined, 'bold');
                        doc.setFontSize(11);
                        const secao = row.querySelector('.section-header').textContent;
                        doc.text(secao, 20, y);
                        y += 7;
                        doc.setFontSize(10);
                    } else {
                        // Tarefa
                        if (y > 275) {
                            doc.addPage();
                            y = 20;
                        }
                        
                        const checkbox = row.querySelector('input[type="checkbox"]');
                        const status = checkbox && checkbox.checked ? 'OK' : 'Pendente';
                        const acao = row.cells[0].textContent.replace(/\d+/, '').trim();
                        const prioridade = row.querySelector('.priority-dropdown');
                        const prioText = prioridade ? (prioridade.value === 'urgente' ? 'URGENTE' : prioridade.value === 'nao-urgente' ? 'Nao Urgente' : '-') : '-';
                        
                        doc.setFont(undefined, 'normal');
                        const texto = `[${status}] ${acao}`;
                        doc.text(texto, 20, y, { maxWidth: 150 });
                        doc.setFont(undefined, 'bold');
                        doc.text(`[${prioText}]`, 180, y, { align: 'right' });
                        y += 6;
                    }
                });
                
                // Salvar
                const nomeArquivo = `CheckList_Reformas_${hoje.replace(/\//g, '-')}.pdf`;
                doc.save(nomeArquivo);
                console.log('‚úÖ PDF gerado:', nomeArquivo);
                alert('‚úÖ PDF exportado com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro ao exportar PDF:', error);
                alert('‚ùå Erro ao exportar PDF. Veja o console para mais detalhes.');
            }
        }
        
        // Fun√ß√£o para exportar para Excel
        function exportToExcel() {
            try {
                console.log('üìä Iniciando exporta√ß√£o Excel...');
                
                // Verificar se XLSX est√° carregado
                if (typeof XLSX === 'undefined') {
                    alert('‚ùå Erro: Biblioteca XLSX n√£o carregada. Recarregue a p√°gina e tente novamente.');
                    console.error('XLSX n√£o est√° dispon√≠vel');
                    return;
                }
                
                const wb = XLSX.utils.book_new();
                
                // Preparar dados
                const data = [
                    ['Check List Reformas - Academia Athenea'],
                    [`Gerado em: ${new Date().toLocaleDateString('pt-BR')}`],
                    [],
                    ['Estat√≠sticas:'],
                    ['Total de Tarefas', document.getElementById('statTotal').textContent],
                    ['Conclu√≠das', document.getElementById('statCompleted').textContent],
                    ['Pendentes', document.getElementById('statPending').textContent],
                    ['Progresso', document.getElementById('statPercent').textContent],
                    [],
                    ['Se√ß√£o', 'Prioridade Ordem', 'A√ß√£o', 'Status', 'Prioridade Tipo', 'Respons√°vel', 'Observa√ß√µes']
                ];
                
                const rows = document.querySelectorAll('tbody tr:not(.hidden)');
                let currentSection = '';
                
                rows.forEach(row => {
                    if (row.querySelector('.section-header')) {
                        currentSection = row.querySelector('.section-header').textContent;
                    } else {
                        const checkbox = row.querySelector('input[type="checkbox"]');
                        const status = checkbox && checkbox.checked ? 'Conclu√≠da' : 'Pendente';
                        
                        const prioNumero = row.querySelector('.priority-number')?.textContent || '';
                        const acao = row.cells[0].textContent.replace(/\d+/, '').trim();
                        
                        const dropdown = row.querySelector('.priority-dropdown');
                        const prioTipo = dropdown ? (dropdown.value === 'urgente' ? 'URGENTE' : dropdown.value === 'nao-urgente' ? 'N√£o Urgente' : '') : '';
                        
                        const responsavel = row.querySelector('textarea[id^="resp"]')?.value || '';
                        const observacoes = row.querySelector('textarea[id^="obs"]')?.value || '';
                        
                        data.push([
                            currentSection,
                            prioNumero,
                            acao,
                            status,
                            prioTipo,
                            responsavel,
                            observacoes
                        ]);
                    }
                });
                
                const ws = XLSX.utils.aoa_to_sheet(data);
                
                // Ajustar larguras das colunas
                ws['!cols'] = [
                    { wch: 30 }, // Se√ß√£o
                    { wch: 10 }, // Prioridade Ordem
                    { wch: 40 }, // A√ß√£o
                    { wch: 12 }, // Status
                    { wch: 15 }, // Prioridade Tipo
                    { wch: 25 }, // Respons√°vel
                    { wch: 40 }  // Observa√ß√µes
                ];
                
                XLSX.utils.book_append_sheet(wb, ws, 'Reformas');
                
                // Salvar
                const hoje = new Date().toLocaleDateString('pt-BR').replace(/\//g, '-');
                const nomeArquivo = `CheckList_Reformas_${hoje}.xlsx`;
                XLSX.writeFile(wb, nomeArquivo);
                console.log('‚úÖ Excel gerado:', nomeArquivo);
                alert('‚úÖ Excel exportado com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro ao exportar Excel:', error);
                alert('‚ùå Erro ao exportar Excel. Veja o console para mais detalhes.');
            }
        }
        
        // Fun√ß√£o para inicializar gr√°ficos
        function initCharts() {
            // Aguardar um momento para os dados estarem carregados
            setTimeout(() => {
                updateProgressBar();
                createPieChart();
                // createBarChart(); // Removido - gr√°fico de barras n√£o √© mais usado
            }, 500);
        }
        
        // Atualizar barra de progresso
        function updateProgressBar() {
            const percentText = document.getElementById('statPercent').textContent;
            const percent = parseInt(percentText.replace('%', '')) || 0;
            const progressBar = document.getElementById('progressBar');
            
            if (progressBar) {
                progressBar.style.width = percent + '%';
                progressBar.textContent = percent + '%';
            }
        }
        
        // Criar gr√°fico de pizza
        function createPieChart() {
            const canvas = document.getElementById('pieChart');
            if (!canvas) {
                console.warn('‚ö†Ô∏è Canvas pieChart n√£o encontrado');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.warn('‚ö†Ô∏è Contexto 2D do pieChart n√£o dispon√≠vel');
                return;
            }
            
            // Verificar se Chart.js est√° carregado
            if (typeof Chart === 'undefined') {
                console.error('‚ùå Chart.js n√£o est√° carregado');
                return;
            }
            
            const completed = parseInt(document.getElementById('statCompleted').textContent) || 0;
            const pending = parseInt(document.getElementById('statPending').textContent) || 0;
            
            console.log('üìä Criando gr√°fico de pizza:', { completed, pending });
            
            if (pieChart) {
                pieChart.destroy();
            }
            
            try {
                pieChart = new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Conclu√≠das', 'Pendentes'],
                        datasets: [{
                            data: [completed, pending],
                            backgroundColor: [
                                'rgba(39, 174, 96, 0.8)',
                                'rgba(231, 76, 60, 0.8)'
                            ],
                            borderColor: [
                                'rgba(39, 174, 96, 1)',
                                'rgba(231, 76, 60, 1)'
                            ],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        aspectRatio: 1.8,
                        plugins: {
                            legend: {
                                position: 'bottom',
                                labels: {
                                    font: {
                                    size: 14
                                },
                                padding: 15,
                                color: document.body.classList.contains('dark-theme') ? '#e0e0e0' : '#2c3e50'
                            }
                        }
                    }
                }
                });
                console.log('‚úÖ Gr√°fico de pizza criado');
            } catch (error) {
                console.error('‚ùå Erro ao criar gr√°fico de pizza:', error);
            }
        }
        
        // Criar gr√°fico de barras por se√ß√£o
        /* REMOVIDO - Gr√°fico de barras por se√ß√£o n√£o √© mais usado
        function createBarChart() {
            const canvas = document.getElementById('barChart');
            if (!canvas) {
                console.warn('‚ö†Ô∏è Canvas barChart n√£o encontrado');
                return;
            }
            
            const ctx = canvas.getContext('2d');
            if (!ctx) {
                console.warn('‚ö†Ô∏è Contexto 2D do barChart n√£o dispon√≠vel');
                return;
            }
            
            // Verificar se Chart.js est√° carregado
            if (typeof Chart === 'undefined') {
                console.error('‚ùå Chart.js n√£o est√° carregado');
                return;
            }
            
            // Coletar dados por se√ß√£o
            const sections = {};
            let currentSection = '';
            
            const rows = document.querySelectorAll('tbody tr:not(.hidden)');
            rows.forEach(row => {
                if (row.querySelector('.section-header')) {
                    currentSection = row.querySelector('.section-header').textContent.trim();
                    if (!sections[currentSection]) {
                        sections[currentSection] = { total: 0, completed: 0 };
                    }
                } else if (currentSection) {
                    const checkbox = row.querySelector('input[type="checkbox"]');
                    if (checkbox) {
                        sections[currentSection].total++;
                        if (checkbox.checked) {
                            sections[currentSection].completed++;
                        }
                    }
                }
            });
            
            // Preparar dados para o gr√°fico
            const labels = Object.keys(sections);
            const totals = labels.map(label => sections[label].total);
            const completed = labels.map(label => sections[label].completed);
            
            console.log('üìä Criando gr√°fico de barras:', { labels, totals, completed });
            
            if (barChart) {
                barChart.destroy();
            }
            
            try {
                barChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels.map(l => l.length > 20 ? l.substring(0, 20) + '...' : l),
                        datasets: [{
                            label: 'Total',
                            data: totals,
                            backgroundColor: 'rgba(52, 152, 219, 0.7)',
                        borderColor: 'rgba(52, 152, 219, 1)',
                        borderWidth: 2
                    }, {
                        label: 'Conclu√≠das',
                        data: completed,
                        backgroundColor: 'rgba(39, 174, 96, 0.7)',
                        borderColor: 'rgba(39, 174, 96, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: document.body.classList.contains('dark-theme') ? '#e0e0e0' : '#2c3e50'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-theme') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                            }
                        },
                        x: {
                            ticks: {
                                color: document.body.classList.contains('dark-theme') ? '#e0e0e0' : '#2c3e50'
                            },
                            grid: {
                                color: document.body.classList.contains('dark-theme') ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: {
                                    size: 14
                                },
                                padding: 15,
                                color: document.body.classList.contains('dark-theme') ? '#e0e0e0' : '#2c3e50'
                            }
                        }
                    }
                }
                });
                console.log('‚úÖ Gr√°fico de barras criado');
            } catch (error) {
                console.error('‚ùå Erro ao criar gr√°fico de barras:', error);
            }
        }
        */
        
        // Indicador de status
        function showStatus() {
            const statusDiv = document.createElement('div');
            statusDiv.id = 'connection-status';
            statusDiv.style.cssText = `
                position: fixed; 
                bottom: 10px; 
                right: 10px; 
                padding: 10px 15px; 
                border-radius: 5px; 
                font-size: 12px; 
                font-weight: bold;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                z-index: 1000;
            `;
            
            if (isConfigured && supabase) {
                statusDiv.style.background = '#4CAF50';
                statusDiv.style.color = 'white';
                statusDiv.textContent = 'üåê Online - Sincronizado com Supabase';
                statusDiv.title = 'Dados sendo salvos no banco de dados';
            } else {
                statusDiv.style.background = '#FF9800';
                statusDiv.style.color = 'white';
                statusDiv.textContent = '‚ö†Ô∏è Offline - Apenas Local';
                statusDiv.title = 'Configure o Supabase para sincroniza√ß√£o entre dispositivos';
            }
            
            document.body.appendChild(statusDiv);
        }
        
        // ============================================
        // SISTEMA DE NOTIFICA√á√ïES
        // ============================================
        
        const notifications = [];
        let notificationId = 0;
        
        // Adicionar notifica√ß√£o
        function addNotification(title, message, type = 'info') {
            const notification = {
                id: ++notificationId,
                title,
                message,
                type, // 'success', 'info', 'warning', 'error'
                timestamp: new Date()
            };
            
            notifications.push(notification);
            updateNotificationBadge();
            renderNotifications();
            
            console.log(`üîî Notifica√ß√£o: [${type}] ${title} - ${message}`);
            
            // Remover automaticamente ap√≥s 30 segundos
            setTimeout(() => {
                removeNotification(notification.id);
            }, 30000);
        }
        
        // Remover notifica√ß√£o
        function removeNotification(id) {
            const index = notifications.findIndex(n => n.id === id);
            if (index !== -1) {
                notifications.splice(index, 1);
                updateNotificationBadge();
                renderNotifications();
            }
        }
        
        // Atualizar badge de contagem
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            const count = document.getElementById('notificationCount');
            
            if (notifications.length > 0) {
                badge.classList.remove('hidden');
                count.textContent = notifications.length;
            } else {
                badge.classList.add('hidden');
            }
        }
        
        // Renderizar lista de notifica√ß√µes
        function renderNotifications() {
            const list = document.getElementById('notificationList');
            
            if (notifications.length === 0) {
                list.innerHTML = '<div class="notification-empty">Nenhuma notifica√ß√£o</div>';
                return;
            }
            
            list.innerHTML = notifications.map(n => `
                <div class="notification-item ${n.type}">
                    <div class="notification-title">${n.title}</div>
                    <div class="notification-message">${n.message}</div>
                    <div class="notification-time">${formatTime(n.timestamp)}</div>
                </div>
            `).reverse().join('');
        }
        
        // Formatar tempo
        function formatTime(date) {
            const now = new Date();
            const diff = Math.floor((now - date) / 1000); // segundos
            
            if (diff < 60) return 'Agora';
            if (diff < 3600) return `${Math.floor(diff / 60)} min atr√°s`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h atr√°s`;
            return date.toLocaleDateString('pt-BR');
        }
        
        // Setup de listeners
        function setupNotifications() {
            const badge = document.getElementById('notificationBadge');
            const panel = document.getElementById('notificationPanel');
            const closeBtn = document.getElementById('closeNotifications');
            
            badge.addEventListener('click', () => {
                panel.classList.toggle('open');
            });
            
            closeBtn.addEventListener('click', () => {
                panel.classList.remove('open');
            });
            
            // Fechar ao clicar fora
            document.addEventListener('click', (e) => {
                if (!panel.contains(e.target) && !badge.contains(e.target)) {
                    panel.classList.remove('open');
                }
            });
        }
        
        // Verificar tarefas urgentes
        function checkUrgentTasks() {
            const rows = document.querySelectorAll('tbody tr');
            let urgentPending = 0;
            
            rows.forEach(row => {
                if (row.querySelector('.section-header')) return;
                
                const checkbox = row.querySelector('input[type="checkbox"]');
                const dropdown = row.querySelector('.priority-dropdown');
                
                if (checkbox && !checkbox.checked && dropdown && dropdown.value === '1') {
                    urgentPending++;
                }
            });
            
            if (urgentPending > 0) {
                addNotification(
                    '‚ö†Ô∏è Tarefas Urgentes',
                    `Voc√™ tem ${urgentPending} tarefa(s) urgente(s) pendente(s)!`,
                    'warning'
                );
            }
        }
        
        // Verificar marcos de progresso
        function checkProgressMilestones() {
            const percentText = document.getElementById('statPercent').textContent;
            const percent = parseInt(percentText.replace('%', '')) || 0;
            
            const milestones = [25, 50, 75, 100];
            const lastMilestone = parseInt(localStorage.getItem('lastMilestone') || '0');
            
            for (const milestone of milestones) {
                if (percent >= milestone && lastMilestone < milestone) {
                    localStorage.setItem('lastMilestone', milestone);
                    
                    let emoji = 'üéØ';
                    if (milestone === 50) emoji = 'üî•';
                    if (milestone === 75) emoji = 'üöÄ';
                    if (milestone === 100) emoji = 'üéâ';
                    
                    addNotification(
                        `${emoji} Marco Alcan√ßado!`,
                        `Parab√©ns! Voc√™ completou ${milestone}% das tarefas!`,
                        'success'
                    );
                    break;
                }
            }
        }
        
        // Monitorar status online/offline
        function setupOfflineDetection() {
            const indicator = document.getElementById('offlineIndicator');
            
            window.addEventListener('offline', () => {
                indicator.classList.add('show');
                addNotification(
                    'üì° Modo Offline',
                    'Voc√™ est√° offline. Suas altera√ß√µes ser√£o salvas localmente.',
                    'warning'
                );
            });
            
            window.addEventListener('online', () => {
                indicator.classList.remove('show');
                addNotification(
                    '‚úÖ Conectado',
                    'Voc√™ est√° online novamente! Sincronizando dados...',
                    'success'
                );
                
                // Tentar sincronizar
                setTimeout(async () => {
                    await restoreCheckboxStates();
                    await restoreTextFields();
                    await restoreFieldSizes();
                    await restorePriorityDropdowns();
                }, 1000);
            });
            
            // Verificar status inicial
            if (!navigator.onLine) {
                indicator.classList.add('show');
            }
        }
        
        // ============================================
        // SISTEMA DE BUSCA E FILTROS
        // ============================================
        
        // Busca em tempo real
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            
            // Aplicar debounce para melhor performance
            const performSearch = debounce(function(searchTerm) {
                const rows = document.querySelectorAll('tbody tr');
                
                rows.forEach(row => {
                    // Pular headers de se√ß√£o
                    if (row.querySelector('.section-header')) {
                        return;
                    }
                    
                    const text = row.textContent.toLowerCase();
                    
                    if (text.includes(searchTerm)) {
                        row.classList.remove('hidden');
                    } else {
                        row.classList.add('hidden');
                    }
                });
                
                updateStats();
            }, 300); // Aguardar 300ms ap√≥s √∫ltima digita√ß√£o
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                performSearch(searchTerm);
            });
        }
        
        // Filtros
        let currentFilter = 'all';
        
        function filterTasks(type) {
            currentFilter = type;
            const rows = document.querySelectorAll('tbody tr');
            
            // Atualizar bot√µes ativos
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            
            if (type === 'all') {
                document.getElementById('filterAll').classList.add('active');
                rows.forEach(row => {
                    if (!row.querySelector('.section-header')) {
                        row.classList.remove('hidden');
                    }
                });
            } else if (type === 'urgente') {
                document.getElementById('filterUrgent').classList.add('active');
                rows.forEach(row => {
                    if (row.querySelector('.section-header')) return;
                    
                    const dropdown = row.querySelector('.priority-dropdown');
                    if (dropdown && dropdown.value === 'urgente') {
                        row.classList.remove('hidden');
                    } else {
                        row.classList.add('hidden');
                    }
                });
            } else if (type === 'concluidas') {
                document.getElementById('filterCompleted').classList.add('active');
                rows.forEach(row => {
                    if (row.querySelector('.section-header')) return;
                    
                    const checkbox = row.querySelector('input[type="checkbox"]');
                    if (checkbox && checkbox.checked) {
                        row.classList.remove('hidden');
                    } else {
                        row.classList.add('hidden');
                    }
                });
            } else if (type === 'pendentes') {
                document.getElementById('filterPending').classList.add('active');
                rows.forEach(row => {
                    if (row.querySelector('.section-header')) return;
                    
                    const checkbox = row.querySelector('input[type="checkbox"]');
                    if (checkbox && !checkbox.checked) {
                        row.classList.remove('hidden');
                    } else {
                        row.classList.add('hidden');
                    }
                });
            }
            
            updateStats();
        }
        
        // Atualizar estat√≠sticas
        function updateStats() {
            const allCheckboxes = document.querySelectorAll('tbody tr:not(.hidden) input[type="checkbox"][id]');
            const total = allCheckboxes.length;
            const completed = Array.from(allCheckboxes).filter(cb => cb.checked).length;
            const pending = total - completed;
            const percent = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statCompleted').textContent = completed;
            document.getElementById('statPending').textContent = pending;
            document.getElementById('statPercent').textContent = percent + '%';
            
            console.log('üìä Stats atualizadas:', { total, completed, pending, percent });
            
            // Atualizar gr√°ficos
            try {
                updateProgressBar();
                createPieChart();
                // createBarChart(); // Removido - gr√°fico de barras n√£o √© mais usado
            } catch (error) {
                console.error('‚ùå Erro ao atualizar gr√°ficos:', error);
            }
        }
        
        // ============================================
        // TEMA CLARO/ESCURO
        // ============================================
        
        function setupThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const savedTheme = localStorage.getItem('theme') || 'light';
            
            // Aplicar tema salvo
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                themeToggle.textContent = '‚òÄÔ∏è';
            }
            
            themeToggle.addEventListener('click', function() {
                document.body.classList.toggle('dark-theme');
                
                if (document.body.classList.contains('dark-theme')) {
                    themeToggle.textContent = '‚òÄÔ∏è';
                    localStorage.setItem('theme', 'dark');
                } else {
                    themeToggle.textContent = 'üåô';
                    localStorage.setItem('theme', 'light');
                }
            });
        }
        
        // Atualizar estat√≠sticas quando checkboxes mudam
        function setupStatsUpdate() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', updateStats);
            });
        }
        
        // Inicializar quando a p√°gina carregar
        window.addEventListener('DOMContentLoaded', async function() {
            console.log('üöÄ Iniciando checklist...');
            console.log(`üìä Supabase configurado: ${isConfigured}`);
            
            // M√©tricas de performance
            const startTime = performance.now();
            
            // Verificar bibliotecas externas
            console.log('üìö Verificando bibliotecas:');
            console.log(`  - jsPDF: ${typeof window.jspdf !== 'undefined' ? '‚úÖ Carregado' : '‚ùå N√ÉO carregado'}`);
            console.log(`  - XLSX: ${typeof XLSX !== 'undefined' ? '‚úÖ Carregado' : '‚ùå N√ÉO carregado'}`);
            console.log(`  - Chart.js: ${typeof Chart !== 'undefined' ? '‚úÖ Carregado' : '‚ùå N√ÉO carregado'}`);
            
            addUniqueIds();
            
            // Aplicar lazy loading para imagens
            setupLazyLoading();
            
            console.log('‚è≥ Carregando dados...');
            await restoreCheckboxStates();
            await restoreTextFields();
            await restoreFieldSizes();
            await restorePriorityDropdowns();
            
            setupCheckboxListeners();
            setupTextFieldListeners();
            setupResizeListeners();
            setupPriorityDropdownListeners();
            showStatus();
            addSyncButton();
            
            // Novas funcionalidades (cr√≠ticas)
            setupSearch();
            setupThemeToggle();
            setupStatsUpdate();
            updateStats();
            initCharts();
            
            // Etapa 3: Sistema de Notifica√ß√µes e Offline
            setupNotifications();
            setupOfflineDetection();
            
            // ‚ö° OTIMIZA√á√ÉO: Adiar sincroniza√ß√£o em tempo real para depois
            // Isso reduz a carga inicial e melhora o tempo de carregamento
            setTimeout(() => {
                setupRealtimeSync();
                setupTextFieldRealtimeSync();
                setupFieldSizeRealtimeSync();
                console.log('üîÑ Sincroniza√ß√£o em tempo real ativada (adiada)');
            }, 5000); // Aguardar 5 segundos ap√≥s carregamento
            
            // Verificar tarefas urgentes ap√≥s o carregamento inicial
            setTimeout(() => {
                checkUrgentTasks();
                checkProgressMilestones();
            }, 3000); // Reduzido de 2s para 3s
            
            // Notifica√ß√£o de boas-vindas
            addNotification(
                'üëã Bem-vindo!',
                'Checklist carregado com sucesso. Boa organiza√ß√£o!',
                'info'
            );
            
            // Ativar filtro "Todas" por padr√£o
            document.getElementById('filterAll').classList.add('active');
            
            // M√©tricas de performance
            const endTime = performance.now();
            const loadTime = (endTime - startTime).toFixed(2);
            console.log(`‚ö° Tempo de carregamento: ${loadTime}ms`);
            console.log('‚úÖ Checklist pronto!');
            
            // Log de m√©tricas de performance
            if (performance.memory) {
                console.log(`üíæ Mem√≥ria usada: ${(performance.memory.usedJSHeapSize / 1048576).toFixed(2)} MB`);
            }
            
            // Inicializar sistema de fotos
            initPhotoSystem();
        }); // Fecha addEventListener DOMContentLoaded
        
        // ============================================
        // SISTEMA DE FOTOS
        // ============================================
        
        function initPhotoSystem() {
            // Adicionar √°rea de fotos em cada linha de tarefa
            const taskRows = document.querySelectorAll('tbody tr');
            
            taskRows.forEach(row => {
                const checkbox = row.querySelector('input[type="checkbox"][id]');
                if (checkbox && !row.querySelector('.section-header') && !row.classList.contains('materials-section')) {
                    const taskId = checkbox.id;
                    const observacoesCell = row.querySelector('.text-cell:last-child');
                    
                    if (observacoesCell) {
                        const photoContainer = createPhotoContainer(taskId);
                        observacoesCell.appendChild(photoContainer);
                        loadPhotosForTask(taskId);
                    }
                }
            });
            
            // Criar modal para visualiza√ß√£o de fotos
            createPhotoModal();
        }
        
        function createPhotoContainer(taskId) {
            const container = document.createElement('div');
            container.className = 'photo-container';
            container.id = `photo-container-${taskId}`;
            
            container.innerHTML = `
                <div class="photo-upload-area">
                    <button class="photo-upload-btn" onclick="document.getElementById('photo-input-${taskId}').click()">
                        üì∑ Adicionar Fotos
                    </button>
                    <input type="file" 
                           class="photo-input" 
                           id="photo-input-${taskId}" 
                           accept="image/*" 
                           multiple 
                           onchange="handlePhotoUpload('${taskId}', this.files)">
                </div>
                <div class="photo-preview-grid" id="photo-grid-${taskId}"></div>
            `;
            
            return container;
        }
        
        async function handlePhotoUpload(taskId, files) {
            if (!files || files.length === 0) return;
            
            const photos = JSON.parse(localStorage.getItem(`photos-${taskId}`) || '[]');
            
            for (let file of files) {
                // Converter para base64
                const base64 = await fileToBase64(file);
                
                photos.push({
                    id: Date.now() + Math.random(),
                    data: base64,
                    name: file.name,
                    uploadDate: new Date().toISOString()
                });
            }
            
            // Salvar no localStorage
            localStorage.setItem(`photos-${taskId}`, JSON.stringify(photos));
            
            // Se Supabase configurado, salvar tamb√©m l√°
            if (isConfigured && supabase) {
                try {
                    await supabase
                        .from('task_photos')
                        .upsert({
                            task_id: taskId,
                            photos: JSON.stringify(photos),
                            updated_at: new Date().toISOString()
                        }, {
                            onConflict: 'task_id'
                        });
                    console.log(`‚úÖ Fotos salvas no Supabase para ${taskId}`);
                } catch (error) {
                    console.error('‚ùå Erro ao salvar fotos no Supabase:', error);
                }
            }
            
            // Atualizar visualiza√ß√£o
            renderPhotos(taskId, photos);
            
            // Mostrar notifica√ß√£o
            addNotification(
                'üì∑ Fotos Adicionadas',
                `${files.length} foto(s) adicionada(s) com sucesso!`,
                'success'
            );
        }
        
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        function renderPhotos(taskId, photos) {
            const grid = document.getElementById(`photo-grid-${taskId}`);
            if (!grid) return;
            
            grid.innerHTML = '';
            
            photos.forEach(photo => {
                const photoItem = document.createElement('div');
                photoItem.className = 'photo-item';
                photoItem.innerHTML = `
                    <img src="${photo.data}" alt="${photo.name}" onclick="openPhotoModal('${photo.data}')">
                    <button class="photo-delete-btn" onclick="deletePhoto('${taskId}', ${photo.id})" title="Excluir foto">√ó</button>
                `;
                grid.appendChild(photoItem);
            });
        }
        
        function loadPhotosForTask(taskId) {
            // Carregar do localStorage primeiro
            const photos = JSON.parse(localStorage.getItem(`photos-${taskId}`) || '[]');
            
            if (photos.length > 0) {
                renderPhotos(taskId, photos);
            }
            
            // Se Supabase configurado, tentar carregar de l√° tamb√©m
            if (isConfigured && supabase) {
                loadPhotosFromSupabase(taskId);
            }
        }
        
        async function loadPhotosFromSupabase(taskId) {
            try {
                const { data, error } = await supabase
                    .from('task_photos')
                    .select('photos')
                    .eq('task_id', taskId)
                    .single();
                
                if (data && data.photos) {
                    const photos = JSON.parse(data.photos);
                    localStorage.setItem(`photos-${taskId}`, JSON.stringify(photos));
                    renderPhotos(taskId, photos);
                }
            } catch (error) {
                console.error(`Erro ao carregar fotos de ${taskId}:`, error);
            }
        }
        
        async function deletePhoto(taskId, photoId) {
            if (!confirm('Tem certeza que deseja excluir esta foto?')) return;
            
            let photos = JSON.parse(localStorage.getItem(`photos-${taskId}`) || '[]');
            photos = photos.filter(p => p.id !== photoId);
            
            localStorage.setItem(`photos-${taskId}`, JSON.stringify(photos));
            
            // Salvar no Supabase
            if (isConfigured && supabase) {
                try {
                    await supabase
                        .from('task_photos')
                        .upsert({
                            task_id: taskId,
                            photos: JSON.stringify(photos),
                            updated_at: new Date().toISOString()
                        }, {
                            onConflict: 'task_id'
                        });
                } catch (error) {
                    console.error('Erro ao excluir foto do Supabase:', error);
                }
            }
            
            renderPhotos(taskId, photos);
            
            addNotification(
                'üóëÔ∏è Foto Exclu√≠da',
                'Foto removida com sucesso!',
                'info'
            );
        }
        
        function createPhotoModal() {
            const modal = document.createElement('div');
            modal.className = 'photo-modal';
            modal.id = 'photoModal';
            modal.innerHTML = `
                <div class="photo-modal-content">
                    <button class="photo-modal-close" onclick="closePhotoModal()">√ó</button>
                    <img id="modalPhoto" src="" alt="Foto ampliada">
                </div>
            `;
            document.body.appendChild(modal);
            
            // Fechar ao clicar fora da imagem
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closePhotoModal();
                }
            });
        }
        
        function openPhotoModal(photoSrc) {
            const modal = document.getElementById('photoModal');
            const img = document.getElementById('modalPhoto');
            img.src = photoSrc;
            modal.classList.add('active');
        }
        
        function closePhotoModal() {
            const modal = document.getElementById('photoModal');
            modal.classList.remove('active');
        }
        
    </script>
</body>
</html>